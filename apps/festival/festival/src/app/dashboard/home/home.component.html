<ng-container *ngIf="titles$ | async as titles; else loading">
  <ng-container *ngIf="titles | hasAppStatus:'accepted'; else noAcceptedMovies">
    <header>
      <h1>Dashboard</h1>
      <div fxLayoutGap="24px">
        <a mat-fab color="black" routerLink="../title/lobby" matTooltip="Add Title">
          <mat-icon svgIcon="add"></mat-icon>
        </a>
        <a mat-fab color="black" routerLink="../title" matTooltip="View Titles">
          <mat-icon svgIcon="movie"></mat-icon>
        </a>
        <a mat-fab color="black" routerLink="../import" matTooltip="Import Titles">
          <mat-icon svgIcon="excel"></mat-icon>
        </a>
      </div>
    </header>

    <ng-container *ngIf="titleAnalytics$ | async as analytics; else loading">
      <ng-container *ngIf="analytics.length else empty">

        <section class="surface carousel-container">
          <ng-container *ngIf="popularTitle$ | async as title else loading">
            <header>
              <h3>{{ title.title.international }}</h3>
              <a mat-button [routerLink]="['title', title.id]">
                <span>See Analytics details</span>
                <mat-icon svgIcon="arrow_forward"></mat-icon>
              </a>
            </header>
            <bf-carousel>
              <analytics-pie-chart class="surface" carouselItem [data]="orgActivityOfPopularTitle$ | async">
              </analytics-pie-chart>
              <analytics-map class="surface" carouselItem [data]="territoryActivityOfPopularTitle$ | async">
                <ng-template #header>
                    <article>
                      <h5>
                        <mat-icon svgIcon="landscape"></mat-icon>
                        <span>Split by Company Territory</span>
                      </h5>
                      <p class="mat-caption">Learn where are the interested people from.</p>
                    </article>
                </ng-template>
              </analytics-map>
              <analytics-line-chart class="surface" carouselItem [eventNames]="interactions"
                [data]="interactionsOfPopularTitle$ | async">
                <h5>
                  <mat-icon svgIcon="switch_access_shortcut"></mat-icon>
                  <span>Interactions</span>
                </h5>
                <p class="mat-caption">Learn how people interact with your Title.</p>

              </analytics-line-chart>
              <analytics-line-chart class="surface" carouselItem [eventNames]="['pageView']" [data]="pageViewsOfPopularTitle$ | async">
                <h5>
                  <mat-icon svgIcon="visibility"></mat-icon>
                  <span>Film Page Views</span>
                </h5>
                <p class="mat-caption">See how many Buyers viewed your Film Page recently.</p>
              </analytics-line-chart>
            </bf-carousel>
          </ng-container>

          <a mat-button class="see_titles" routerLink="title">
            <span>View all Titles Activity</span>
            <mat-icon svgIcon="arrow_forward"></mat-icon>
          </a>
        </section>

      </ng-container>
    </ng-container>
    <section>
      <h3>Buyers' Insights</h3>
      <analytics-map class="surface map-insights" [data]="activeCountries$ | async" [topCountryCount]="5" horizontal showLegend>
      </analytics-map>
    </section>
  </ng-container>

  <ng-template #noAcceptedMovies>
    <section fxLayout="column" fxLayoutAlign="center center" class="no-accepted-movies">
      <ng-container *ngIf="titles.length; else noMovies">
        <h1>No title to display.</h1>
        <p class="mat-body-1">
          As long as don't have any title to display, your organization will not appear on the marketplace.
          <br>
          You can either add several titles at once through bulk import, or just one at a time.
        </p>
        <p class="mat-body-2">
          N.B.: Only submitted projects will appear on the marketplace, not drafts.
        </p>
      </ng-container>
      <ng-template #noMovies>
        <dashboard-no-title></dashboard-no-title>
      </ng-template>
      <article fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="center" fxLayoutGap="24px">
        <!-- Should only be shown for noAcceptedMovies && !noMovies -->
        <ng-container *ngIf="titles | hasAppStatus:'draft'">
          <div class="surface" fxLayout="column" fxLayoutalign="center center">
            <img asset="add_draft.svg" alt="Manage Drafts">
            <a routerLink="../title" mat-button color="primary">Manage Drafts</a>
          </div>
        </ng-container>
        <div class="surface" fxLayout="column" fxLayoutalign="center center">
          <img asset="add_title.svg" alt="Add title image">
          <a routerLink="../title/lobby" mat-button color="primary">Add one Title</a>
        </div>
        <div class="surface" fxLayout="column">
          <img asset="add_files.svg" alt="Upload files image">
          <a routerLink="../import" mat-button color="primary" test-id="import">Import Titles in bulk</a>
        </div>
      </article>
      <h3>Or</h3>
      <button (click)="openIntercom()" mat-flat-button color="primary">
        Contact the {{ app | appName }} team
      </button>
    </section>
  </ng-template>
</ng-container>

<ng-template #loading>
  <article fxLayout="column" fxLayoutAlign="center center">
    <mat-spinner color="primary"></mat-spinner>
  </article>
</ng-template>

<ng-template #empty>
  <section class="no-analytics">
    <img asset="wait.svg" alt="waiting">
    <p class="mat-body-2">There are no statistics available here yet.</p>
  </section>
</ng-template>
