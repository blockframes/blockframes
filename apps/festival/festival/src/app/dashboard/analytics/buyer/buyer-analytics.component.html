<header class="dark-contrast-theme" bgAsset="background_header.png" bgTheme="dark">
  <button mat-icon-button (click)="goBack()">
    <mat-icon svgIcon="arrow_back"></mat-icon>
  </button>

  <ng-container *ngIf="user$ | async as user">
    <article>
      <a [routerLink]="['/c/o/marketplace/organization/', user.orgId]">
        <img [ref]="user.org.logo" asset="empty_organization.svg" type="logo" alt="Organizaiton Logo">
      </a>

      <div>
        <h4>{{ user | displayName }}</h4>
        <h1>{{ user.org | orgName }}</h1>
        <h5>{{ user.org.activity | toLabel:'orgActivity' }}</h5>

        <a mat-button [href]="'mailto:' + user.email">
          <mat-icon svgIcon="mail"></mat-icon>
          <span>{{ user.email }}</span>
        </a>
      </div>
    </article>
  </ng-container>
</header>

<section>
  <div class="metrics" *ngIf="aggregated$ | async as analytics">
    <ng-container *ngFor="let event of events">
      <analytics-metric-card [title]="event.title" [value]="analytics[event.name]" [icon]="event.icon"></analytics-metric-card>
    </ng-container>
  </div>

  <article>
    <h3>Buyer was interested in these titles</h3>
    <bf-table [source]="aggregatedPerTitle$ | async" pagination="5" userFilter>
      <ng-template colRef="title.title.international" label="Title" let-title sort>
        {{ title | maxLength:50 }}
      </ng-template>
      <ng-template colRef="title.release.year" label="Release year" let-release sort>
        {{ release }}
      </ng-template>
      <ng-template colRef="title.originCountries" label="Country of Origin" let-countries sort>
        {{ countries | toLabel:'territories' }}
      </ng-template>
      <ng-template colRef="title.originalLanguages" label="Original Language" let-languages sort>
        {{ languages | toLabel:'languages' }}
      </ng-template>
      <ng-template colRef label="In wishlist" let-wishlist sort>
        {{ inWishlist(wishlist) ? 'Yes' : '-' }}
      </ng-template>
      <ng-template colRef="promoReelOpened" label="Promotional Elements" let-promoReelOpened sort>
        {{ promoReelOpened }}
      </ng-template>
      <ng-template colRef="screeningRequested" label="Screening Requests" let-screeningRequested sort>
        {{ screeningRequested }}
      </ng-template>
      <ng-template colRef="askingPriceRequested" label="Asking Price Requested" let-askingPriceRequested sort>
        {{ askingPriceRequested }}
      </ng-template>
    </bf-table>
  </article>
</section>