<ng-container *ngIf="(event$ | async) as event; else loading">


  <h1>Meeting Lobby</h1>
  <h2>{{event.title}}</h2>
  <section *ngIf="(local$ | async) as local">

    <meeting-video [attendee]="local"></meeting-video>

    <aside>
      <div fxLayout="row" fxLayoutGap="32px">
        <ng-container *ngIf="local.tracks.video as videoTrack">
          <button
            mat-fab
            color="primary"
            [matTooltip]="'Turn ' + (videoTrack.isEnabled ? 'off' : 'on') + ' camera'"
            (click)="toggleLocalTrack('video')"
          >
            <mat-icon *ngIf="videoTrack.isEnabled" svgIcon="videocam"></mat-icon>
            <mat-icon *ngIf="!videoTrack.isEnabled" svgIcon="videocam_off"></mat-icon>
          </button>
        </ng-container>
        <ng-container *ngIf="!local.tracks.video">
          <!-- We put the tooltip on a parent <span> because tooltip are not displayed on disabled buttons -->
          <span matTooltip="Your browser don't have the permission to access the camera">
            <button mat-fab disabled>
              <mat-icon svgIcon="videocam"></mat-icon>
            </button>
          </span>
        </ng-container>

        <ng-container *ngIf="local.tracks.audio as audioTrack">
          <button
            mat-fab
            color="primary"
            [matTooltip]="'Turn ' + (audioTrack.isEnabled ? 'off' : 'on') + ' mic'"
            (click)="toggleLocalTrack('audio')"
          >
            <mat-icon *ngIf="audioTrack.isEnabled" svgIcon="unmute"></mat-icon>
            <mat-icon *ngIf="!audioTrack.isEnabled" svgIcon="mute"></mat-icon>
          </button>
        </ng-container>
        <ng-container *ngIf="!local.tracks.audio">
          <!-- We put the tooltip on a parent <span> because tooltip are not displayed on disabled buttons -->
          <span matTooltip="Your browser don't have the permission to access the microphone">
            <button mat-fab disabled>
              <mat-icon svgIcon="unmute"></mat-icon>
            </button>
          </span>
        </ng-container>
      </div>

      <ng-container [ngSwitch]="attendeeStatus">
        <ng-container *ngSwitchCase="'owner' || 'accepted'">
          <a mat-flat-button routerLink="../session" color="accent" class="request">Access {{ event.type | titlecase }} Room</a>
        </ng-container>
        <ng-container *ngSwitchCase="'requesting'">
          <a mat-flat-button disabled color="accent" class="request">Waiting for request to be accepted...</a>
        </ng-container>
        <ng-container *ngSwitchCase="'denied'">
          <div fxLayout="column" fxLayoutAlign="end center" class="request">
            Your request to join has been denied.
            <a mat-flat-button (click)="requestAccess()" color="accent">Ask to join again</a>
          </div>
        </ng-container>
        <ng-container *ngSwitchDefault>
          <ng-container *ngIf="ownerIsPresent else ownerNotPresent">
            <a mat-flat-button (click)="requestAccess()" color="accent" class="request">Ask to join {{ event.type | titlecase }} Room</a>
          </ng-container>
          <ng-template #ownerNotPresent>
            <a mat-flat-button disabled color="accent" class="request">Waiting for owner...</a>
          </ng-template>
        </ng-container>
      </ng-container>

    </aside>

  </section>

  <img asset="meeting.webp" alt="Meeting room">

</ng-container>

<ng-template #loading>
  <section fxLayout="column" fxLayoutAlign="center center">
    <mat-spinner></mat-spinner>
  </section>
</ng-template>
