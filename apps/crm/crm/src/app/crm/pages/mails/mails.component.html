<main fxLayout="column">
  <crm-bread-crumb></crm-bread-crumb>
  <article fxLayout="row" fxLayoutAlign="space-around start">
    <mat-card fxLayout="column" fxLayoutAlign="space-between start">
      <mat-card-header>
        <mat-card-title>Send a test email</mat-card-title>
      </mat-card-header>
      <ng-container *ngIf="form">
        <form [formGroup]="form">
          <mat-card-content>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>From</mat-label>
              <mat-select formControlName="from">
                <mat-option *ngFor="let from of sendgridEmailsFrom | keyvalue" [value]="from.value.email">
                  {{ from.value.email }}( {{ from.value.name }} )
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>To</mat-label>
              <input matInput type="text" placeholder="To" formControlName="to" required />
            </mat-form-field>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Subject</mat-label>
              <input matInput type="text" placeholder="Subject" formControlName="subject" required />
            </mat-form-field>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Message</mat-label>
              <textarea matInput placeholder="Add a message" formControlName="text"></textarea>
            </mat-form-field>
          </mat-card-content>
          <mat-card-actions align="end">
            <button *ngIf="loading === false else sending" type="text" mat-flat-button color="primary"
              (click)="sendTestEmail()">
              <mat-icon svgIcon="send"></mat-icon>
              Send test email
            </button>
            <ng-template #sending>
              <span>Sending... </span>
              <mat-spinner [diameter]="20" [strokeWidth]="2" class="send-spinner"></mat-spinner>
            </ng-template>
          </mat-card-actions>
        </form>
      </ng-container>
    </mat-card>
    <mat-card fxLayout="column" fxLayoutAlign="space-between start">
      <mat-card-header>
        <mat-card-title>Email tools</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <a href="https://app.sendgrid.com/" target="_blank">
          <mat-icon svgIcon="build"></mat-icon>Go to Sendgrid dashboard
        </a>
      </mat-card-content>
    </mat-card>
  </article>
</main>