<section *ngIf="contract$ | async as contract" fxLayout="column" fxLayoutGap="25px">
  <!-- TITLE & PRICE -->
  <article
    *ngIf="licensees[0].party as licensee"
    fxLayout="row"
    fxLayoutAlign="space-between start">
    <article fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGap="25px">
      <!-- Switch to [imgRef]="getLicenseeLogo(licensees[0].part.orgId) when public orgs are here => ISSUE#1359"-->
      <img class="logo" [imgRef]="placeholderUrl" [placeholderUrl]="placeholderUrl" alt="Organization logo" />
      <div>
        <p>{{ lastVersion.status | uppercase }}</p>
        <h1>{{ licensees[0].party.displayName }} - {{ moviesLenght$ | async }} films</h1>
        <span class="mat-body-1" *ngIf="licensee.address">
          {{ licensee.address.street }}, {{ licensee.address.city }}, {{ licensee.address.region }}
          {{ licensee.address.zipCode }}, {{ licensee.address.country }}
        </span>
      </div>
    </article>
    <div fxLayout="column" fxLayoutAlign="center end">
      <caption class="mat-caption"> {{ lastVersion.creationDate | date: 'short' }} </caption>
      <h2>{{ totalPrice.amount | currency: getCurrencyCode(totalPrice.currency) }}</h2>
    </div>
  </article>

  <!-- CONTRACT SUMMARY -->
  <article fxLayout="row" fxLayoutGap="25px">
    <mat-card>
      <mat-card-title>
        <h3>
          {{ licensees[0].party.displayName }} has made an offer for
          {{ contract.titleIds.length }} titles, {{ moviesLenght$ | async }} of which are yours.
        </h3>
      </mat-card-title>
      <mat-card-content>
        <span *ngIf="subLicensors.length > 1" class="mat-body-1">
          We are gathering approval from {{ subLicensors.length - 1 }} other sellers.
        </span>
        <span i18n *ngIf="subLicensors.length > 1; else uniqueSubLicensor" class="mat-body-1">
          Your share of the deal is <b>{{ totalPrice.amount | currency: getCurrencyCode(totalPrice.currency) }}</b>
          for the {{ moviesLenght$ | async }} film:
        </span>
        <ng-template #uniqueSubLicensor>
          <span class="mat-body-1">
            The offer is <b>{{ totalPrice.amount | currency: totalPrice.currency }}</b>
            for the {{ moviesLenght$ | async }} films:
          </span>
        </ng-template>
        <ul *ngFor="let movieWithDeals of moviesWithDeals$ | async">
          <ng-container *ngIf="showMovie(movieWithDeals.movie.id)">
            <li><b>{{ movieWithDeals.movie.main.title.international }}</b></li>
          </ng-container>
        </ul>
      </mat-card-content>
      <mat-card-actions *ngIf="isSignatory" fxLayout="row" fxLayoutAlign="space-between center">
        <button mat-flat-button color="accent" (click)="openIntercom()">
          <mat-icon svgIcon="comment"></mat-icon>
          Connect with the Archipel Team
        </button>
        <div>
          <button mat-flat-button color="primary" (click)="acceptOffer(contract)">
            <mat-icon svgIcon="check"></mat-icon>
            Accept
          </button>
          <button mat-flat-button color="warn" (click)="declineOffer(contract)">
            <mat-icon svgIcon="refuse"></mat-icon>
            Decline
          </button>
        </div>
      </mat-card-actions>
    </mat-card>
    <mat-card>
      <mat-card-title>
        <h3>Proposed Payment Schedule</h3>
        <div *ngFor="let payment of lastVersion.paymentSchedule" fxLayout="column" fxLayoutAlign="center start">
          <span class="mat-body-1">{{ payment.percentage }}% {{ payment.label }}</span>
          <caption class="mat-caption">{{ payment.date }}</caption>
        </div>
      </mat-card-title>
    </mat-card>
  </article>

  <!-- NEGOCIATION HISTORY -->
  <mat-card>
    <mat-card-title><h3>Negociation History</h3></mat-card-title>
    <bf-table-filter
      [source]="versions"
      [columns]="versionColumns"
      [initialColumns]="initialVersionColumns">
    </bf-table-filter>
  </mat-card>

  <!-- DISTRIBUTION DEALS -->
  <ng-container *ngFor="let movieWithDeals of moviesWithDeals$ | async">
    <mat-card *ngIf="showMovie(movieWithDeals.movie.id)">
      <mat-accordion >
        <mat-expansion-panel
          (opened)="panelOpenState = true"
          (closed)="panelOpenState = false">
          <mat-expansion-panel-header>
            <mat-panel-title fxLayout="row" fxLayoutAlign="space-between">
              <h3>{{ movieWithDeals.movie.main.title.international }}</h3>
              <span *ngIf="lastVersion.titles[movieWithDeals.movie.id].price as price">
                {{ price.amount | currency : getCurrencyCode(price.currency) }}
              </span>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <mat-divider></mat-divider>
          <bf-table-filter
            [source]="movieWithDeals.deals"
            [columns]="dealColumns"
            [initialColumns]="initialDealColumns"
            [showFilter]="true">
          </bf-table-filter>
        </mat-expansion-panel>
      </mat-accordion>
    </mat-card>
  </ng-container>
</section>
