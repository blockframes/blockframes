<ng-container *ngIf="movies$ | async as movies; else loading">
  <ng-container *ngIf="movies.length; else empty">

    <h1>My Titles</h1>

    <div fxLayout="row" fxLayoutAlign="end center">
      <a mat-flat-button color="primary" routerLink="lobby" test-id="add-movie">
        <span>New Title</span>
        <mat-icon svgIcon="add"></mat-icon>
      </a>
    </div>

    <header mat-tab-nav-bar fxLayout="row" fxLayoutAlign="space-between end">
      <button mat-tab-link (click)="resetFilter()" [active]="!(filter$ | async)">All projects</button>
      <button mat-tab-link (click)="applyFilter('draft')" [active]="(filter$ | async) === 'draft'">Drafts</button>
      <button mat-tab-link (click)="applyFilter('submitted')"
        [active]="(filter$ | async) === 'submitted'">Submitted</button>
      <button mat-tab-link (click)="applyFilter('accepted')"
        [active]="(filter$ | async) === 'accepted'">Published</button>
    </header>

    <mat-card>
      <bf-table-filter [source]="movies | filterBy: filterByMovie: filter.value" [columns]="columns"
        [initialColumns]="initialColumns" clickable showFilter showPaginator (rowClick)="goToTitle($event)">
        <ng-template colRef="title" let-title><b>{{ title.international }}</b></ng-template>
        <ng-template colRef="release" let-release><b>{{ release.year }}</b></ng-template>
        <ng-template colRef="directors" let-directors><b>{{ directors | displayName }}</b></ng-template>
        <ng-template colRef="views" let-movie="item"><b>{{movie.id | getViews | async}}</b></ng-template>
        <ng-template colRef="storeConfig" let-storeConfig>{{ storeConfig.status | toLabel: 'storeStatus' }}</ng-template>
      </bf-table-filter>
    </mat-card>
  </ng-container>
</ng-container>

<ng-template #loading>
  <mat-spinner></mat-spinner>
</ng-template>

<ng-template #empty>
  <section fxLayout="column" fxLayoutAlign="center center">
    <dashboard-no-title></dashboard-no-title>
    <article fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="center" fxLayoutGap="24px">
      <mat-card class="no-title-card" fxLayout="column" fxLayoutalign="center center">
        <img asset="add_title.webp" alt="Add title">
        <a routerLink="lobby" mat-button color="primary">Add one title</a>
      </mat-card>
      <mat-card class="no-title-card" fxLayout="column">
        <img asset="add_files.webp" alt="Upload files">
        <a routerLink="../import" mat-button color="primary">Import titles in bulk</a>
      </mat-card>
    </article>
    <h3>Or</h3>
    <button (click)="openIntercom()" mat-flat-button color="primary">
      Contact the {{ appName }} team
    </button>
  </section>
</ng-template>
