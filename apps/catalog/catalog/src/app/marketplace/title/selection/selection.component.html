<ng-container *ngIf="bucket$ | async as bucket">
  <header fxLayout="column" fxLayoutAlign="start center">
    <!-- TODO add background to section -->
    <h1>My Selection</h1>
    <p>There are {{ bucket.contracts.length }} titles in my selection</p>
    <p>Total price: {{ '300' | currency:bucket.currency }}</p>
    <button mat-flat-button color="primary" (click)="createOffer()">Create Offer</button>
  </header>

  <section>
    <h2>Please choose currency</h2>
    <mat-form-field appearance="fill">
      <mat-label>Select</mat-label>
      <mat-select [value]="bucket.currency" (selectionChange)="updateCurrency($event.value)">
        <ng-container *ngFor="let currency of currencies | keyvalue">
          <mat-option [value]="currency.key">{{ currency.value }}</mat-option>
        </ng-container>
      </mat-select>
    </mat-form-field>
  </section>

  <ng-container *ngFor="let contract of bucket.contracts; let i = index">
    <section>
      <header fxLayout fxLayoutAlign="space-between start">
        <ng-container *ngIf="contract.titleId | getTitle | async as title">
          <article fxLayout="column">
            <h2>{{ title.title.international }}</h2>
            <img [ref]="title.poster | storageFile: 'movies':'poster':title.id" asset="empty_poster.webp"
              alt="Movie Illustration" [delay]="0">
          </article>
          <mat-form-field>
            <mat-label>Price</mat-label>
            <input matInput type="number" [value]="contract.price" (blur)="updatePrice(i, $event.target.value)" />
            <mat-icon matPrefix [svgIcon]="bucket.currency"></mat-icon>
          </mat-form-field>
        </ng-container>
      </header>
      <bf-table-filter [source]="contract.terms" [columns]="columns" [initialColumns]="initialColumns" showFilter
        showPaginator>
        <ng-template colRef="duration" let-duration>
          {{ duration.from | date }} - {{ duration.to | date }}
        </ng-template>
        <ng-template colRef="territories" let-territories>
          {{ territories.join(', ') }}
        </ng-template>
        <ng-template colRef="medias" let-medias>
          {{ medias.join(', ') }}
        </ng-template>
        <ng-template colRef="exclusivity" let-exclusivity>
          {{ exclusivity ? 'Yes' : 'No' }}
        </ng-template>
      </bf-table-filter>
    </section>
  </ng-container>
</ng-container>