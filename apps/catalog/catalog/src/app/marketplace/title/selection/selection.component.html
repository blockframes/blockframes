<!-- In case bucket doesn't exist yet, empty is shown -->
<ng-container *ngIf="bucket$ | async as bucket; else empty">
  <ng-container *ngIf="!!bucket.contracts.length else empty">
    <header class="dark-contrast-theme main-header" bgAsset="banner_header_page.webp">
      <div class="main-title" fxLayout="column" fxLayoutAlign="center center">
        <h1>My Selection</h1>
        <p>There are {{ bucket.contracts.length }} titles in my selection</p>
        <p>Total price: {{ total$ | async | currency:bucket.currency }}</p>
      </div>
      <div fxLayout="column" fxLayoutAlign="center center">
        <p *ngIf="bucket | bucketTitles | getTitle | async as titles">
          {{ (titles | deepKey:'title.international') }}
        </p>
        <button mat-flat-button color="primary" (click)="createOffer(bucket)">Create Offer</button>
      </div>
    </header>

    <section>
      <h2>Please select a currency</h2>
      <static-select test-id="selection-currency" [control]="currencyForm" scope="movieCurrencies"
        [withoutValues]="withoutCurrencies">
        <mat-label>Currency</mat-label>
      </static-select>
    </section>

    <contract-item
      [bucket]="bucket$ |async "
      [columns]="columns"
      [priceTemplate]="priceTemplate"
      [colActionsTemplate]="colActions"
      [initialColumns]="initialColumns"
      (setPrice)="setPrice"
      (updatePrice)="updatePrice"
      (openDetails)="openDetails"
      (removeTerm)="removeTerm"
      (removeContract)="removeContract"
      >
      <ng-template #priceTemplate let-index="index" let-price="price">
        <mat-form-field appearance="outline">
          <mat-label>Price</mat-label>
          <input matInput type="number" min="0" [value]="price" [attr.test-id]="'price-' + index"
            (input)="setPrice(index, $event.target.value)" (blur)="updatePrice(index, $event.target.value)" />
          <mat-icon matPrefix [svgIcon]="bucket.currency"></mat-icon>
        </mat-form-field>
      </ng-template>
      <ng-template #colActions label="Actions" let-termIndex="index" let-contractIndex="contractIndex" let-titleId="titleId">
        <a mat-icon-button [routerLink]="['/c/o/marketplace/title', titleId, 'avails']" [queryParams]="{ contract: contractIndex, term: termIndex }" matTooltip="Edit">
          <mat-icon svgIcon="edit"></mat-icon>
        </a>
        <button mat-icon-button (click)="removeTerm(contractIndex, termIndex)" matTooltip="Delete">
          <mat-icon svgIcon="delete"></mat-icon>
        </button>
      </ng-template>
    </contract-item>

    <footer fxLayout="column" fxLayoutAlign="center center" class="summary" test-id="footer-total-price">
      <p test-id="total-price">Total Price: {{ total$ | async | currency:bucket.currency }}</p>
      <button mat-flat-button color="accent" (click)="createOffer(bucket)" test-id="create-offer">Create Offer</button>
    </footer>
  </ng-container>
</ng-container>

<ng-template #empty>
  <section class="empty" fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="16px">
    <h1>There is no title to display in your Selection.</h1>
    <span>Select titles to populate your Selection.</span>
    <img asset="empty_selection.png" alt="No rights in selection">
    <button mat-flat-button color="accent" [routerLink]="['/c/o/marketplace/title']">Browse Library</button>
  </section>
</ng-template>
