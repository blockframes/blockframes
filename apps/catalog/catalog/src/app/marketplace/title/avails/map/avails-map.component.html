
<aside>
  <mat-card>
    <mat-card-header>
      <mat-card-title>Avail Search Criteria</mat-card-title>
    </mat-card-header>
    <mat-divider></mat-divider>
    <mat-card-header>
      <mat-card-subtitle>
        <p>Fill in the following fields to know where, when and in which conditions this title is available.</p>
        <p>
          Search results use an "and" logic for multiple conditions, not an "or" logic.
          <mat-icon matTooltip="If you check TV and VOD media, you will get territories where both media are available (not either of them)" svgIcon="info"></mat-icon>
        </p>
      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="availsForm">
        <static-group formControlName="medias" scope="medias" displayAll="All Rights" required placeholder="Specify right(s) to filter" [withoutValues]="['theatrical']" test-id="medias" icon="play_arrow">
          <mat-label>Media</mat-label>
        </static-group>

        <mat-form-field appearance="outline">
          <mat-label>Exlusivity</mat-label>
          <mat-select formControlName="exclusive" required>
            <mat-option [value]="true">Exclusive</mat-option>
            <mat-option [value]="false">Non exclusive</mat-option>
          </mat-select>
          <mat-icon matPrefix svgIcon="star"></mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" formGroupName="duration">
          <mat-label>Start Date</mat-label>
          <input matInput [matDatepicker]="datepickerFrom" formControlName="from" required>
          <mat-datepicker-toggle matPrefix [for]="datepickerFrom" test-id="dateFrom"></mat-datepicker-toggle>
          <mat-datepicker #datepickerFrom> </mat-datepicker>
          <mat-error *ngIf="availsForm.hasError('startOverEnd', 'duration.from')">Start date must not be later than end date</mat-error>
          <mat-error *ngIf="availsForm.hasError('inPast', 'duration.from')">Date must be in the future</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" formGroupName="duration">
          <mat-label>End Date</mat-label>
          <input matInput [matDatepicker]="datepickerTo" formControlName="to" required>
          <mat-datepicker-toggle matPrefix [for]="datepickerTo" test-id="dateTo"></mat-datepicker-toggle>
          <mat-datepicker #datepickerTo> </mat-datepicker>
          <mat-error *ngIf="availsForm.hasError('startOverEnd', 'duration.to')">End date must not be earlier than start date</mat-error>
          <mat-error *ngIf="availsForm.hasError('inPast', 'duration.from')">Date must be in the future</mat-error>
        </mat-form-field>
      </form>
      <article fxLayout fxLayoutAlign="space-between">
        <button mat-stroked-button (click)="clear()">Search for new rights</button>
      </article>
    </mat-card-content>
  </mat-card>
</aside>

<mat-card class="avails-card">
  <mat-card-header>
    <mat-card-title>Available Territories</mat-card-title>
    <mat-card-subtitle *ngIf="org$ | async as org">
      Click on the territories you're interested in to add them to your Selection. For territories that are not licensed, feel free to
      <a [routerLink]="['/c/o/marketplace/organization', org.id, 'member']">contact {{ org | orgName }}</a>.
    </mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <world-map>

      <!-- MAP LAYERS -->
      <ng-container *ngFor="let tag of (available$ | async); trackBy: trackByTag">
        <map-feature [tag]="tag.isoA3" color="color-1" (click)="addTerritory(tag)"
          (mouseover)="displayTerritoryTooltip(tag.label, 'Available')" (mouseout)="clearTerritoryTooltip()">
        </map-feature>
      </ng-container>
      <ng-container *ngFor="let tag of (sold$ | async); trackBy: trackByTag">
        <map-feature [tag]="tag.isoA3" color="color-2"
          (mouseover)="displayTerritoryTooltip(tag.label, 'Rights sold')" (mouseout)="clearTerritoryTooltip()">
        </map-feature>
      </ng-container>
      <ng-container *ngFor="let tag of (selected$ | async); trackBy: trackByTag">
        <map-feature [tag]="tag.isoA3" color="color-4" (click)="removeTerritory(tag)"
          (mouseover)="displayTerritoryTooltip(tag.label, 'Selected')" (mouseout)="clearTerritoryTooltip()">
        </map-feature>
      </ng-container>
      <ng-container *ngFor="let tag of (inSelection$ | async); trackBy: trackByTag">
        <map-feature [tag]="tag.isoA3" color="color-4"
          (mouseover)="displayTerritoryTooltip(tag.label, 'Already in selection')" (mouseout)="clearTerritoryTooltip()">
        </map-feature>
      </ng-container>

      <!-- TOOLTIP ON HOVERING-->
      <mat-card *ngIf="hoveredTerritory" class="hovered-territory-card">
        <ul>
          <li> {{ hoveredTerritory.name }} </li>
          <li class="mat-caption"> {{ hoveredTerritory.status }} </li>
        </ul>
      </mat-card>

      <!-- MAP LEGEND -->
      <mat-card class="colors-card">
        <mat-list>
          <mat-list-item>
            <svg viewBox="0 0 100 100" width="10px" height="10px">
              <rect fill="var(--color-1)" x="0" y="0" width="100" height="100" />
            </svg>
            <span class="mat-caption">Available</span>
          </mat-list-item>
          <mat-list-item>
            <svg viewBox="0 0 100 100" width="10px" height="10px">
              <rect fill="var(--color-2)" x="0" y="0" width="100" height="100" />
            </svg>
            <span class="mat-caption">Rights Sold</span>
          </mat-list-item>
          <mat-list-item>
            <svg viewBox="0 0 100 100" width="10px" height="10px">
              <rect fill="var(--color-3)" x="0" y="0" width="100" height="100" />
            </svg>
            <span class="mat-caption">
              Not Licensed
              <mat-icon matTooltip="You can contact the seller directly for more information." svgIcon="info"></mat-icon>
            </span>
          </mat-list-item>
        </mat-list>
      </mat-card>
    </world-map>
    <article fxLayout fxLayoutAlign="end">
      <button mat-button color="primary" (click)="selectAll()">
        <mat-icon svgIcon="add"></mat-icon>
        Select all available territories
      </button>
    </article>
  </mat-card-content>

</mat-card>
