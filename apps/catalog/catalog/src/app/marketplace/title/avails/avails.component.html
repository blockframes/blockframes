
<header fxLayout fxLayoutAlign="space-between center">
  <span>First time here? <button mat-button (click)="explain()">Learn how it works</button></span>
  <span>
    <a mat-button routerLink="map" routerLinkActive="mat-primary">Multiple Territory</a>
    <a mat-button routerLink="calendar" routerLinkActive="mat-primary">Single Territory</a>
  </span>
</header>

<router-outlet></router-outlet>

<ng-container *ngIf="(terms$ | async).length">
  <h2 id="rights">Preselected Rights</h2>
  <mat-card *ngFor="let control of terms$ | async | reverse">
    <form [formGroup]="control" *ngIf="control.value as term">
      <mat-card-header fxLayout fxLayoutAlign="space-between center">
        <mat-card-title>{{ term.exclusive ? 'Exclusive' : 'Non Exclusive' }} Rights from {{ term.duration.from | date: 'MM/dd/yyyy' }} until {{ term.duration.to | date: 'MM/dd/yyyy' }}</mat-card-title>
        <section fxLayoutGap="12px">
          <button mat-icon-button (click)="edit(term)" matTooltip="Edit">
            <mat-icon svgIcon="edit"></mat-icon>
          </button>
          <button mat-icon-button (click)="remove(control)" matTooltip="Delete">
            <mat-icon svgIcon="delete"></mat-icon>
          </button>
        </section>
      </mat-card-header>
      <mat-card-content>
        <mat-accordion>
          <!-- TERRITORIES -->
          <mat-expansion-panel expanded>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Territories
              </mat-panel-title>
            </mat-expansion-panel-header>
            <article class="expansion-panel-content">
              <ng-container *ngIf="term.territories.length <= maxTerritories; else moreTerritories">
                <mat-chip-list aria-label="Territories">
                  <mat-chip *ngFor="let territory of term.territories">{{ territory | toLabel: 'territories' }}</mat-chip>
                </mat-chip-list>
              </ng-container>
              <ng-template #moreTerritories>
                <div fxFlex fxLayout="column" fxLayoutAlign="start end">
                  <mat-chip-list aria-label="Territories">
                    <ng-container *ngFor="let territory of term.territories, index as i">
                      <mat-chip *ngIf="i < maxTerritories">{{ territory | toLabel: 'territories' }}</mat-chip>
                    </ng-container>
                  </mat-chip-list>
                  <button mat-button class="spacing" (click)="openTerritoryModal(term.territories, 'territories')">... See {{ term.territories.length - 30 }} More</button>
                </div>
              </ng-template>
            </article>

          </mat-expansion-panel>

          <!-- MEDIAS -->
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Medias
              </mat-panel-title>
            </mat-expansion-panel-header>
            <article class="expansion-panel-content">
              <mat-chip-list aria-label="Medias">
                <mat-chip *ngFor="let media of term.medias">{{ media | toLabel: 'medias' }}</mat-chip>
              </mat-chip-list>
            </article>
          </mat-expansion-panel>

          <!-- VERSIONS -->
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Versions
                <span class="mat-body-2">&nbsp;(Non Mandatory)</span>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <article class="expansion-panel-content">
              <h5>Original Languages</h5>
              <p>{{ movie.originalLanguages | toLabel: 'languages' }}</p>
              <h5>Request Specific Versions</h5>

              <languages-form [form]="control.controls.languages"></languages-form>
            </article>
          </mat-expansion-panel>

          <!-- RUNS -->
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Runs
                <span class="mat-body-2">&nbsp;(Non Mandatory)</span>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <article class="expansion-panel-content" fxLayout="column" fxFlex formGroupName="runs">
              <p>Broadcasts</p>
              <mat-form-field appearance="outline">
                <mat-label>Number of Broadcasts</mat-label>
                <input matInput type="number" placeholder="Number of Broadcasts" formControlName="broadcasts">
              </mat-form-field>
              <p>Catch Up Rights</p>
              <div fxFlex fxLayout fxLayoutGap="16px" fxLayoutAlign="start space-between" formGroupName="catchup">
                <mat-form-field appearance="outline" fxFlex>
                  <mat-label>Start Date</mat-label>
                  <input matInput [matDatepicker]="datePicker" placeholder="MM/DD/YYYY" formControlName="from">
                  <mat-datepicker-toggle matPrefix [for]="datePicker">
                    <mat-icon matDatepickerToggleIcon svgIcon="calendar_today"></mat-icon>
                  </mat-datepicker-toggle>
                  <mat-datepicker #datePicker></mat-datepicker>
                </mat-form-field>
                <mat-form-field appearance="outline" fxFlex>
                  <mat-label>Duration</mat-label>
                  <input matInput type="number" placeholder="Duration" formControlName="duration">
                </mat-form-field>
                <mat-form-field appearance="outline" fxFlex>
                  <mat-label>Period</mat-label>
                  <mat-select matInput placeholder="Period" formControlName="period">
                    <mat-option *ngFor="let period of periods" [value]="period">
                      {{ period | titlecase }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </article>
          </mat-expansion-panel>
        </mat-accordion>
      </mat-card-content>
    </form>
  </mat-card>
  <section fxLayout fxLayoutAlign="space-between">
    <button mat-stroked-button color="primary" class="mat-body-2" (click)="clear()">
      Search for new terms and rights
    </button>
    <button mat-flat-button color="primary" class="mat-body-2" (click)="addToSelection()">
      <span>Add to Selection</span>
      <mat-icon svgIcon="arrow_forward"></mat-icon>
    </button>
  </section>
</ng-container>