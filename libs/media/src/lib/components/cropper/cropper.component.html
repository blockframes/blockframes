<section [ngSwitch]="step$ | async">

  <!-- Drop -->
  <article dropZone (dropped)="filesSelected($event)" *ngSwitchCase="'drop'" @zoomDelay>
    <input #fileUploader multiple hidden type="file" (change)="filesSelected($event.target.files)" />
    <button mat-icon-button aria-label="file upload button" (click)="fileUploader.click()">
      <img class="add-files-icon" asset="add_files.webp" alt="upload image">
    </button>
    <ng-content select="[type]"></ng-content>
    <ng-content select="[dimensions]"></ng-content>
    <ng-content select="[format]"></ng-content>
    <p class="mat-caption">Drag and drop a file here or <a (click)="fileUploader.click()">browse</a></p>
  </article>

  <!-- Crop -->
  <article class="cropper" *ngSwitchCase="'crop'" @zoomDelay>
    <image-cropper [imageFile]="file" [aspectRatio]="cropRatio" format="webp" [containWithinAspectRatio]="false"
      [resizeToWidth]="setWidth || parentWidth" (imageCropped)="imageCropped($event)"></image-cropper>
    <div class="buttons" fxLayout="row" fxLayoutAlign="space-evenly center">
      <button mat-mini-fab color="primary">
        <mat-icon (click)="cropIt()" svgIcon="check"></mat-icon>
      </button>
      <button mat-mini-fab color="warn">
        <mat-icon (click)="nextStep(prev)" svgIcon="cross">cancel</mat-icon>
      </button>
    </div>
  </article>

  <!-- Upload -->
  <article *ngSwitchCase="'upload'" @zoomDelay>
    <div *ngIf="( percentage$ | async ) as percentage" fxLayout="column" fxLayoutAlign="center center">
      <mat-progress-spinner color="primary" mode="determinate" [value]="percentage$ | async">
      </mat-progress-spinner>
      <p>{{ percentage | number:'1.0-0' }}% uploading...</p>
    </div>
  </article>

  <!-- Complete -->
  <article *ngSwitchCase="'upload_complete'">
    <svg width="100" height="100" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path @check (@check.done)="goToShow()" class="check-path" d="M34 100L74 140L167 47" stroke="#3f51b5"
        stroke-width="17" />
    </svg>
    <div *ngIf="resizing" fxLayout="column" fxLayoutAlign="center center">
      <p>Generating the preview...</p>
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    </div>
  </article>

  <!-- Show -->
  <article class="show" *ngSwitchCase="'show'" @finalZoom>
    <ng-container>
      <div class="show">
        <img class="croppedImage" [src]="croppedImage || (previewUrl$ | async)" />
      </div>
      <div class="buttons" fxLayout="row" fxLayoutAlign="space-evenly center">
        <ng-container *ngIf="useFileUploader">
          <input #fileUploader multiple hidden type="file" (change)="filesSelected($event.target.files)" />
          <button mat-mini-fab color="primary">
            <mat-icon (click)="fileUploader.click()" svgIcon="picture" matTooltip="Select new picture"></mat-icon>
          </button>
        </ng-container>
        <button mat-mini-fab color="accent" *ngIf="(previewUrl$ | async) as url">
          <mat-icon [cdkCopyToClipboard]="url" svgIcon="archive" matTooltip="Copy to clipboard"></mat-icon>
        </button>
        <!-- TODO #1149: fix resize in cropper -->
        <!-- <mat-icon (click)="resize(url)" mat-button fontSet="material-icons-outlined" color="primary" matTooltip="resize current picture">icon</mat-icon> -->
        <ng-container *ngIf="useDelete">
          <button mat-mini-fab color="warn">
            <mat-icon (click)="delete()" svgIcon="trash" matTooltip="Delete current picture"></mat-icon>
          </button>
        </ng-container>
      </div>
    </ng-container>
  </article>
</section>
