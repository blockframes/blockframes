<section [ngSwitch]="step$ | async">
  <article dropZone (dropped)="filesSelected($event)" *ngSwitchCase="'drop'" @zoomDelay>
    <input #fileUploader multiple hidden type="file" (change)="filesSelected($event.target.files)" />
    <button mat-icon-button aria-label="file upload button" (click)="fileUploader.click()">
      <img asset="add_files.svg" alt="upload image"/>
    </button>
    <ng-content select="[type]"></ng-content>
    <ng-content select="[dimensions]"></ng-content>
    <ng-content select="[format]"></ng-content>
    <p class="mat-caption">Drag and drop a file here or <button mat-button color="primary" (click)="fileUploader.click()">Browse</button></p>
  </article>
  <article class="cropper" *ngSwitchCase="'crop'" @zoomDelay>
    <image-cropper
      [imageFile]="file"
      [aspectRatio]="cropRatio"
      [containWithinAspectRatio]="true"
      [resizeToWidth]="setWidth || parentWidth"
      (imageCropped)="imageCropped($event)"
    ></image-cropper>
    <div class="buttons" fxLayout="row" fxLayoutAlign="space-evenly center">
      <button mat-mini-fab color="primary">
        <mat-icon (click)="cropIt()" svgIcon="check"></mat-icon>
      </button>
      <button mat-mini-fab color="warn">
        <mat-icon (click)="nextStep(prev)" svgIcon="cross">cancel</mat-icon>
      </button>
    </div>
  </article>
  <article *ngSwitchCase="'upload'" @zoomDelay>
    <div *ngIf="( percentage$ | async ) as percentage">
      <mat-progress-spinner class="example-margin" color="primary" mode="determinate" [value]="percentage$ | async">
      </mat-progress-spinner>
      <p>{{ percentage | number:'1.0-0' }}% uploading....</p>
    </div>
  </article>
  <article *ngSwitchCase="'upload_complete'">
    <svg width="100" height="100" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        @check
        (@check.done)="goToShow()"
        class="check-path"
        d="M34 100L74 140L167 47"
        stroke="#3f51b5"
        stroke-width="17"
      />
    </svg>
  </article>
  <article class="show" *ngSwitchCase="'show'" @finalZoom>
    <ng-container *ngIf="url$ | async as url">
      <div class="show">
        <img class="croppedImage" [src]="url" />
      </div>
      <div class="buttons" fxLayout="row" fxLayoutAlign="space-evenly center">
        <ng-container *ngIf="useFileuploader">
          <input #fileUploader multiple hidden type="file" (change)="filesSelected($event.target.files)" />
          <button mat-mini-fab color="primary">
            <mat-icon (click)="fileUploader.click()" svgIcon="picture" matTooltip="select new picture"></mat-icon>
          </button>
        </ng-container>
        <!-- TODO #1149: fix resize in cropper -->
        <!-- <mat-icon (click)="resize(url)" mat-button fontSet="material-icons-outlined" color="primary" matTooltip="resize current picture">icon</mat-icon> -->
        <ng-container *ngIf="useDelete">
          <button mat-mini-fab color="warn">
            <mat-icon (click)="delete()" svgIcon="trash" matTooltip="delete current picture"></mat-icon>
          </button>
        </ng-container>
      </div>
    </ng-container>
  </article>
</section>
