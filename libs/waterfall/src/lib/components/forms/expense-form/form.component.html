<section class="surface" *ngIf="!contractId">
  <h3>Expenses Types</h3>
  <p class="mat-body-1">Specify expense types and cap for Direct Sales statements.</p>
  <waterfall-expense-types-form contractId="directSales"></waterfall-expense-types-form>
</section>
<section *ngFor="let expenseType of (expenseTypes$ | async)" class="surface">
  <h3>{{ expenseType.name }}</h3>
  <p class="mat-body-1">Please note, only the capped sums will be used for the calculation.</p>
  <div>
    <ng-container *ngIf="expenseType.cap.default > 0 else uncapped">
      <!-- TODO #9520 replace default by versionId -->
      <strong>{{ expenseType.name }} CAP:</strong> <price-per-currency [price]="expenseType.id | expenseTypeAmount : (simulation$ | async).waterfall.state"></price-per-currency> <span> ( max <price-per-currency [price]="expenseType.cap.default | formatPair: expenseType.currency"></price-per-currency>)</span>
    </ng-container>
    <ng-template #uncapped>
      <p class="mat-body-1">Uncapped</p>
    </ng-template>
  </div>
  <bf-form-table *ngIf="form.getExpenseType(expenseType.id)" [columns]="expenseColumns" [form]="form.getExpenseType(expenseType.id)" [defaultFormValue]="defaultExpenseValue(expenseType)" (itemSaved)="form.markAsDirty()">
    <!-- Columns -->
    <ng-template colRef="" label="Amount" let-item>
      <price-per-currency [price]="item.price | formatPair: item.currency"></price-per-currency>
    </ng-template>
    <ng-template colRef="nature" label="Nature" let-nature>
      {{ nature }}
    </ng-template>
    <ng-template colRef="capped" label="Capped" let-capped>
      <mat-slide-toggle [checked]="capped" disabled color="primary"></mat-slide-toggle>
    </ng-template>
    <!-- Local Form -->
    <ng-template formView let-expenseForm>
      <form [formGroup]="expenseForm" class="group">
        <mat-form-field appearance="outline">
          <mat-label>Nature</mat-label>
          <input matInput [formControl]="expenseForm.get('nature')" required/>
        </mat-form-field>

        <static-select [control]="expenseForm.get('currency')" [only]="['USD', 'EUR']" required scope="movieCurrencies">
          <mat-label>Currency</mat-label>
        </static-select>

        <mat-form-field appearance="outline">
          <mat-label>Amount</mat-label>
          <input type="number" matInput [formControl]="expenseForm.get('price')" required/>
          <mat-icon matPrefix *ngIf="expenseForm.get('currency').value" [svgIcon]="expenseForm.get('currency').value"></mat-icon>
        </mat-form-field>

        <mat-slide-toggle *ngIf="expenseType.cap.default > 0" [formControl]="expenseForm.get('capped')" color="primary"></mat-slide-toggle> <!-- TODO #9520 replace default by versionId -->
      </form>

    </ng-template>

    <ng-template saveButtonText>Save Expense</ng-template>
    <ng-template addButtonText>Add Expense</ng-template>
  </bf-form-table>
</section>