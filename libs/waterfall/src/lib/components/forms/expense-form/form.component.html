<section *ngFor="let expenseType of (expenseTypes$ | async)" class="surface">
  <h3>{{ expenseType.name }}</h3>
  <div>
    <ng-container *ngIf="expenseType.cap.default > 0 else uncapped">
      <ng-container *ngIf="(realTimeExpenses$ | async) as realTimeExpenses">
        <strong>Total capped expenses declared:</strong> 
        <price-per-currency [convertTo]="mainCurrency" [price]="realTimeExpenses[expenseType.id]"></price-per-currency> 
        <span [class]="realTimeExpenses[expenseType.id] | expenseTypeStatus: (expenseType.cap.default | formatPair: expenseType.currency)"> ( CAP <price-per-currency [price]="expenseType.cap.default | formatPair: expenseType.currency"></price-per-currency>)</span>
      </ng-container>
    </ng-container>
    <ng-template #uncapped>
      <p class="mat-body-1">Uncapped</p>
    </ng-template>
  </div>
  <bf-form-table *ngIf="form.getExpenseType(expenseType.id)" [columns]="expenseColumns" [form]="form.getExpenseType(expenseType.id)" showEmptyForm="false" [defaultFormValue]="defaultExpenseValue(expenseType)" (itemSaved)="form.markAsDirty()">
    <!-- Columns -->
    <ng-template colRef="" label="Amount" let-item>
      <price-per-currency [price]="item.price | formatPair: item.currency"></price-per-currency>
    </ng-template>
    <ng-template colRef="nature" label="Expenses name" let-nature>
      {{ nature }}
    </ng-template>
    <ng-template colRef="capped" label="Capped" let-capped>
      {{ capped ? 'Yes' : 'No' }}
    </ng-template>
    <!-- Local Form -->
    <ng-template formView let-expenseForm>
      <form [formGroup]="expenseForm" class="group">
        <mat-form-field appearance="outline">
          <mat-label>Expenses name</mat-label>
          <input matInput [formControl]="expenseForm.get('nature')" required/>
        </mat-form-field>

        <static-select [control]="expenseForm.get('currency')" [only]="['USD', 'EUR']" required scope="movieCurrencies">
          <mat-label>Currency</mat-label>
        </static-select>

        <mat-form-field appearance="outline">
          <mat-label>Amount</mat-label>
          <input type="number" matInput [formControl]="expenseForm.get('price')" required/>
          <mat-icon matPrefix *ngIf="expenseForm.get('currency').value" [svgIcon]="expenseForm.get('currency').value"></mat-icon>
        </mat-form-field>

        <mat-slide-toggle *ngIf="expenseType.cap.default > 0" [formControl]="expenseForm.get('capped')" color="primary">Is capped?</mat-slide-toggle>
      </form>

    </ng-template>

    <ng-template saveButtonText>Save Expense</ng-template>
    <ng-template addButtonText>Add Expense</ng-template>
  </bf-form-table>
</section>