<ng-container *ngIf="showConditionForm$ | async else noConditions">
  <!-- TODO #9896 remove-->
  <div class="right">
    <static-select [control]="rightForm.controls.type" scope="rightTypes" [withoutValues]="['horizontal','vertical']" bfi18n>
      <mat-label i18n>Receipt Share Type</mat-label>
    </static-select>
    <mat-form-field appearance="outline">
      <mat-label i18n>Receipt Share Name</mat-label>
      <input matInput type="text" [formControl]="rightForm.controls.name" />
    </mat-form-field>
  </div>


  <!-- end remove-->

  <ng-container *ngFor="let step of rightForm.controls.steps.value; let stepIndex = index">
    <ng-container *ngIf="selectedStep$.value === stepIndex; else item">
      <section>
        <p *ngIf="canUpdate || step.length" i18n>Treshold {{ stepIndex + 1 }}</p>
        <button mat-button color="primary" [disabled]="!newCondition || !canUpdate" (click)="addNewCondition(step.length)">
          <mat-icon svgIcon="add"></mat-icon>
          <span i18n>Add condition</span>
        </button>
      </section>
    
      <waterfall-condition-item
        *ngFor="let condition of step; let conditionIndex = index"
        [canUpdate]="canUpdate" 
        [condition]="condition" 
        (edit)="editCondition(conditionIndex)" 
        (delete)="deleteCondition(conditionIndex)"
      ></waterfall-condition-item>

      <waterfall-conditions-form [form]="conditionForm" [rightId]="rightId"></waterfall-conditions-form>
    </ng-container>
    <ng-template #item>
      <waterfall-step-item class="surface" [index]="stepIndex" [conditionCount]="step.length" (editStep)="selectStep(stepIndex)" (deleteStep)="removeStep(stepIndex)" [canUpdate]="canUpdate"></waterfall-step-item>
    </ng-template>
  </ng-container>

  <mat-divider></mat-divider>
  <button class="add-step" mat-flat-button color="primary" [disabled]="!canUpdate || (lastStepEmpty$ | async)" (click)="addStep()" i18n>Add another Treshold</button>
</ng-container>

<ng-template #noConditions>
  <p i18n>The conditions will be tested in order that if they are true, the Receipt Share will take its percentage.</p>
  <p i18n>You are working with <strong>{{ rightForm.controls.name.value }}</strong>.</p>
  <button mat-flat-button color="primary" [disabled]="!canUpdate" (click)="addFirstStep()" i18n>Add Threshold</button>
</ng-template>