<mat-radio-group [formControl]="radioCtrl" color="primary">
  <!-- Payments Upon Event -->
  <mat-radio-button value="event">
    PAYMENTS UPON EVENT
  </mat-radio-button>
  <ng-container *ngFor="let control of paymentSchedule.controls; let isLast = last; let i = index">
    <form [formGroup]="control" fxLayout="row" fxLayoutAlign="center baseline" fxLayoutGap="20px">
      <mat-form-field appearance="outline">
        <mat-label>Percentage</mat-label>
        <input matInput type="number" formControlName="percentage" max="100" min="1">
        <mat-icon matSuffix svgIcon="percent"></mat-icon>
      </mat-form-field>
      <mat-form-field appearance="outline" formGroupName="date">
        <mat-label>Triggering event</mat-label>
        <mat-select formControlName="floatingStart">
          <mat-option *ngFor="let event of triggerEvents | keyvalue" [value]="event.key">
            {{event.value}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <ng-container *ngIf="isLast; else remove">
        <button mat-fab (click)="addPayment()" color="primary">
          <mat-icon svgIcon="add"></mat-icon>
        </button>
      </ng-container>
      <ng-template #remove>
        <button mat-fab (click)="removePayment(i)" color="warn">
          <mat-icon>delete</mat-icon>
        </button>
      </ng-template>
    </form>
  </ng-container>
  <mat-divider></mat-divider>
  <!-- Periodic Payments -->
  <mat-radio-button value="periodic" color="primary">
    PERIODIC PAYMENTS
  </mat-radio-button>
  <!-- We only need the first index here, cause the user set the amount of iteration -->
  <ng-container *ngFor="let control of paymentSchedule.controls; let isLast = last; let i = index">
    <form [formGroup]="control" fxLayout="column" fxLayoutAlign="start start" fxLayoutGap="20px" *ngIf="last">
      <mat-form-field appearance="outline">
        <mat-label>Percentage</mat-label>
        <input matInput type="number" formControlName="percentage" max="100" min="1">
        <mat-icon matSuffix svgIcon="percent"></mat-icon>
      </mat-form-field>
      <span class="caption">Every</span>
      <form formGroupName="date" fxLayout="column" fxLayoutAlign="baseline center" fxLayoutGap="20px">
        <div fxLayout="row" fxLayoutGap="20px">
          <mat-form-field appearance="outline" formGroupName="floatingDuration">
            <mat-label>Duration</mat-label>
            <input matInput type="number" formControlName="duration">
          </mat-form-field>
          <mat-form-field appearance="outline" formGroupName="floatingDuration">
            <mat-label>Period</mat-label>
            <mat-select formControlName="unit" >
              <mat-option *ngFor="let duration of durations | keyvalue" [value]="duration.key">
                {{ duration.value }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div fxLayout="row" fxLayoutGap="20px">
          <div fxLayout="column" fxLayoutGap="20px">
            <mat-slide-toggle [formControl]="periodCtrl" color="primary" (change)="updateState($event, 'start')">
              Starting from
            </mat-slide-toggle>
            <mat-form-field appearance="outline">
              <mat-label>Start Date</mat-label>
              <input matInput [matDatepicker]="startDate" formControlName="start">
              <mat-datepicker-toggle matSuffix [for]="startDate"></mat-datepicker-toggle>
              <mat-datepicker #startDate></mat-datepicker>
            </mat-form-field>
          </div>
          <mat-divider vertical></mat-divider>
          <div fxLayout="column" fxLayoutGap="20px">
            <mat-slide-toggle [formControl]="eventCtrl" color="primary" (change)="updateState($event, 'period')">
              Triggering Event
            </mat-slide-toggle>
            <mat-form-field appearance="outline">
              <mat-label>Triggering Event</mat-label>
              <mat-select formControlName="floatingStart">
                <mat-option *ngFor="let event of paymentEvents | keyvalue" [value]="event.key">
                  {{ event.value }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </form>
    </form>
  </ng-container>
  <mat-radio-button value="other" color="primary">
    Other
  </mat-radio-button>
  <mat-form-field appearance="outline">
    <mat-label>Other, please specify</mat-label>
    <input matInput type="text" [formControl]="customPaymentSchedule">
  </mat-form-field>
</mat-radio-group>