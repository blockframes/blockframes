<section fxLayout="column">
  <header fxLayout fxLayout.lt-md="column" fxLayoutGap="16px">
    <ng-container *ngIf="movie$ | async as movie">
      <section fxLayout fxLayoutGap="16px" fxFlex>
        <img fxHide.xs [ref]="movie.poster" asset="empty_poster.webp" alt="movie poster">

        <article fxLayout="column" fxFlex>
          <h4>{{ movie | movieFeature }}</h4>
          <h1>{{ movie.title.international }}</h1>
          <mat-chip-list>
            <mat-chip selected disableRipple class="tag">
              {{ movie.app[appName].status }}
            </mat-chip>
          </mat-chip-list>
          <h6>{{ movie.directors | displayName }}</h6>
          <p>
            <span>{{ movie.originCountries | toLabel: 'territories'}}</span>
            <span *ngIf="movie.originCountries.length && movie.release.year"> - </span>
            <span>{{ movie.release.year }}</span>
          </p>
        </article>
      </section>
      <aside fxLayout="column" fxLayout.lt-md="row" fxLayoutAlign="start end" fxLayoutGap="8px">

        <ng-container *ngIf="movie.app[appName].status === 'archived' else cta">
          <button mat-stroked-button color="primary" (click)="updateStatus(movie, 'draft')">Restore title</button>
        </ng-container>
        <ng-template #cta>
          <ng-container *ngIf="org$ | async | canAccess: 'marketplace': appName">
            <a mat-button [routerLink]="['/c/o/marketplace/title', movie.id, 'main']">
              <mat-icon svgIcon="marketplace"></mat-icon>
              <span>Marketplace Preview</span>
            </a>
          </ng-container>
          <!-- TODO #6084 here goes CTA app specific content -->
          <ng-content select="movie-cta"></ng-content>
        </ng-template>

        <ng-container *ngIf="movie.app[appName].status === 'archived' else actionsMenu">
          <button mat-icon-button (click)="removeAppAccess(movie)" matTooltip="Delete title">
            <mat-icon svgIcon="delete"></mat-icon>
            <span>Delete title</span>
          </button>
        </ng-container>
        <ng-template #actionsMenu>
          <!-- TODO #6084 finnish action menu -->
          <button mat-button [matMenuTriggerFor]="actionMenuMenu">Actions</button>
          <mat-menu #actionMenuMenu="matMenu">
            <a mat-button [routerLink]="['/c/o/dashboard/tunnel/movie', movie.id]">
              <mat-icon svgIcon="edit"></mat-icon>
              <span>Edit</span>
            </a>
            <button mat-menu-item (click)="updateStatus(movie, 'archived')">
              <mat-icon svgIcon="archive"></mat-icon><span matLine>Archive Title</span>
            </button>
            <button mat-menu-item *ngIf="['catalog','financiers'].includes(appName)" (click)="updateStatus(movie, 'submitted')">
              <mat-icon svgIcon="archive"></mat-icon><span matLine>Submit Title</span>
            </button>
            <button mat-menu-item *ngIf="appName === 'festival'" (click)="updateStatus(movie, 'accepted')">
              <mat-icon svgIcon="archive"></mat-icon><span matLine>Publish on Marketplace</span>
            </button>
          </mat-menu>
        </ng-template>
        
      </aside>
    </ng-container>
  </header>

  <nav mat-tab-nav-bar>
    <a mat-tab-link *ngFor="let link of routes" [routerLink]="link.path" routerLinkActive #rla="routerLinkActive"
      [active]="rla.isActive">
      {{link.label}}
    </a>
  </nav>

  <div [@routeAnimation]="animationOutlet(outlet)">
    <router-outlet #outlet="outlet"></router-outlet>
  </div>

</section>
