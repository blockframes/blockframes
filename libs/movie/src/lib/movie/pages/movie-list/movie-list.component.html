<ng-container *ngIf="(loading$ | async); else: loaded"> Loading </ng-container>

<ng-template #loaded>
  <article class="movie-list-container" fxLayout="row wrap" fxLayoutAlign="start space-between">

    <!--Movie Card -->
    <mat-card *ngFor="let movie of (movies$ | async)" class="movie-card">

      <!-- Movie Poster -->
      <div class="img-container clickable-item">

        <ng-container *ngIf="movie.poster; else: defaultPoster">
          <a [routerLink]="['/layout/o', movie.id]">
            <img mat-card-image [src]="movie.poster" alt="Movie poster link" />
          </a>
        </ng-container>

        <ng-template #defaultPoster>
          <a [routerLink]="['/layout/o', movie.id]">
            <img
              class="mat-card-image"
              src="/assets/images/default-movie-poster.png"
              alt="Movie poster link"/>
          </a>
        </ng-template>

        <!-- Movie Menu -->
        <button mat-icon-button [matMenuTriggerFor]="menu">
          <mat-icon color="primary">more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu" xPosition="before">
          <button mat-menu-item [matMenuTriggerFor]="subMenu">
            <mat-icon color="primary">control_camera</mat-icon>
            <span>Open in...</span>
          </button>
          <a mat-menu-item [routerLink]="['../', movie.id, 'edit']">
            <mat-icon color="primary">edit</mat-icon>
            <span>Edit</span>
          </a>
          <button mat-menu-item (click)="delete(movie)">
            <mat-icon color="primary">delete_outline</mat-icon>
            <span>Delete</span>
          </button>
        </mat-menu>
        <mat-menu #subMenu="matMenu">
          <a mat-menu-item [routerLink]="[movie.id]">Explorer</a>
        </mat-menu>

      </div>

      <a [routerLink]="['/layout/o', movie.id]">

        <!-- Movie Informations (title, year, director) -->
        <mat-card-header class="clickable-item">
          <mat-card-title>
            {{ movie.title.original }}
            <span *ngIf="movie.productionYear"> ({{ movie.productionYear }})</span>
          </mat-card-title>
          <mat-card-subtitle *ngIf="movie.directors">
            <span *ngFor="let director of movie.directors; let isLast=last">{{ director.firstName }} {{ director.lastName }} {{ !isLast?'-':'' }}</span>
          </mat-card-subtitle>
        </mat-card-header>
      </a>
    </mat-card>

  </article>

  <div fxLayoutAlign="center center">
    <button mat-raised-button color="primary" (click)="addNewMovie()">Add a movie</button>
  </div>

</ng-template>
