<editable-sidenav (closed)="opened = false" [opened]="opened" (saved)="update()" *ngIf="(delivery$ | async) as delivery">
  <!-- Content -->
  <ng-container content>
    <article *ngIf="(movie$ | async) as movie" fxLayout="row" fxLayoutAlign="none center">
      <h2>{{ movie.main.title.original }}</h2>
      <mat-divider fxFlex></mat-divider>
      <button mat-icon-button matTooltip="Save as a template" (click)="saveAsTemplate()">
        <mat-icon svgIcon="template"></mat-icon>
      </button>
      <a
        mat-icon-button
        matTooltip="Export delivery in a .pdf file"
        [href]="pdfLink"
        target="_blank">
        <mat-icon svgIcon="pdf"></mat-icon>
      </a>
      <button disabled="isDeliverySigned" mat-icon-button matTooltip="Delete delivery" (click)="openDeleteDelivery()">
        <mat-icon svgIcon="delete"></mat-icon>
      </button>
      <button disabled="isDeliverySigned" mat-flat-button color="primary" (click)="addMaterial()">
        <span>
          <mat-icon>add</mat-icon>
          Add material
        </span>
      </button>
    </article>
    <article fxLayout="row" fxLayoutAlign="end center">
      <delivery-actions
        (status)="updateStatus($event)"
        (ordered)="materialIsOrdered()"
        (paid)="materialsIsPaid()">
      </delivery-actions>
    </article>
    <delivery-material-list
      *ngIf="isDeliverySigned"
      [materials]="signedMaterials$ | async"
      [delivery]="delivery"
      [displayedColumns]="displayedColumns"
      (editing)="openSidenav($event)"
      (selectedMaterial)="selectMaterial($event)"
      (selectAllMaterials)="selectAllMaterials($event)">
    </delivery-material-list>
    <delivery-material-list
      *ngIf="!isDeliverySigned"
      [materials]="materials$ | async"
      [delivery]="delivery"
      [displayedColumns]="displayedColumns"
      (editing)="openSidenav($event)"
      (selectedMaterial)="selectMaterial($event)"
      (selectAllMaterials)="selectAllMaterials($event)">
    </delivery-material-list>
  </ng-container>
  <!-- Sidenav -->
  <ng-container sidenav>
    <ng-container *ngIf="(materialFormGroup$ | async) as materialFormGroup">
      <delivery-material-form
        *ngIf="!isDeliverySigned"
        [formGroup]="materialFormGroup"
        [delivery]="delivery$ | async"
        (delete)="openDeleteMaterial($event)">
      </delivery-material-form>
    </ng-container>
    <ng-container *ngIf="(signedMaterialFormGroup$ | async) as signedMaterialFormGroup">
      <delivery-material-form
        *ngIf="isDeliverySigned"
        [isDeliverySigned]="isDeliverySigned"
        [formGroup]="signedMaterialFormGroup"
        [delivery]="delivery$ | async"
        (delete)="openDeleteMaterial($event)">
      </delivery-material-form>
    </ng-container>
  </ng-container>
</editable-sidenav>
