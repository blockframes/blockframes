<mat-sidenav-container>
  <!-- Sidenav -->
  <mat-sidenav [opened]="true" mode="side">
    <material-list *ngIf="(delivery$ | async) as delivery" [template]="delivery"></material-list>
    <article fxLayout="column" fxLayoutAlign="end none" fxLayoutGap="1rem">
      <button mat-raised-button color="primary" (click)="saveAsTemplate()">
        Save as new template
      </button>
      <button mat-raised-button color="warn" (click)="deleteDelivery()">Delete delivery</button>
    </article>
  </mat-sidenav>
  <!-- Content -->
  <mat-sidenav-content class="delivery-form">
    <button class="add-material-button" [disabled]="isDeliveryValidated$ | async" (click)="addForm('')" color="primary" mat-icon-button matRipple>
      <mat-icon class="icon-add">add_circle</mat-icon>
      Add new material
    </button>
    <div *ngIf="(form$ | async) as form">
      <material-form [isDeliveryValidated]="isDeliveryValidated$ | async" *ngIf="form.category === ''" (material)="addMaterial($event)"></material-form>
    </div>
    <mat-card *ngFor="let materials of (delivery$ | async | keyvalue)" [id]="materials.key">
      <mat-card-title class="container" fxLayout="row" fxLayoutAlign="start center">
        <h4 fxFlex="60">Category : {{ materials.key }}</h4>
        <button [disabled]="isDeliveryValidated$ | async" fxFlex="40" (click)="addForm(materials.key)" color="primary" mat-icon-button matRipple>
          <mat-icon class="icon-add">add_circle</mat-icon>
          Add new material with this category
        </button>
      </mat-card-title>
      <mat-card-content>
        <div cdkDrag *ngFor="let material of materials.value">
          <material-item [isDeliveryValidated]="isDeliveryValidated$ | async" [material]="material" (isDeleted)="deleteMaterial(material)"></material-item>
        </div>
        <div *ngIf="(form$ | async) as form">
          <material-form
            [isDeliveryValidated]="isDeliveryValidated$ | async"
            *ngIf="form.category === materials.key"
            (material)="addMaterial($event)"
          ></material-form>
        </div>
      </mat-card-content>
    </mat-card>
    <delivery-stakeholder-list></delivery-stakeholder-list>
  </mat-sidenav-content>
</mat-sidenav-container>
