<main>
  <mat-card>
    <mat-accordion *ngIf="user$ | async as user">
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>

            <span>Personal data</span>
          </mat-panel-title>
          <mat-panel-description>
            <a routerLink="./profile">
              <mat-icon>settings</mat-icon>
            </a>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <mat-list>
          <mat-list-item>
            <mat-card-header>
              <mat-card-title>Id</mat-card-title>
              <mat-card-subtitle>{{ user.uid }}</mat-card-subtitle>
            </mat-card-header>
          </mat-list-item>
          <mat-list-item>
            <mat-card-header>
              <mat-card-title>First Name</mat-card-title>
              <mat-card-subtitle>{{ user.firstName }}</mat-card-subtitle>
            </mat-card-header>
          </mat-list-item>
          <mat-list-item>
            <mat-card-header>
              <mat-card-title>Last Name</mat-card-title>
              <mat-card-subtitle>{{ user.lastName }}</mat-card-subtitle>
            </mat-card-header>
          </mat-list-item>
          <mat-list-item>
            <mat-card-header>
              <mat-card-title>Email</mat-card-title>
              <mat-card-subtitle>{{ user.email }}</mat-card-subtitle>
            </mat-card-header>
          </mat-list-item>
          <mat-list-item>
            <mat-card-header>
              <mat-card-title>Biography</mat-card-title>
              <mat-card-subtitle>
                <p>{{ user.biography }}</p>
              </mat-card-subtitle>
            </mat-card-header>
          </mat-list-item>
        </mat-list>
      </mat-expansion-panel>

      <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Wallet
          </mat-panel-title>
        </mat-expansion-panel-header>
        <section>
          <!-- WALLET -->
          <ng-container *ngIf="user.identity; else walletLoading">
            <header fxLayout="row" fxLayoutAlign="space-between center">
              <!-- Wallet Profile -->
              <div class="wallet-profile">
                <eth-blockie mat-card-avatar [round]="false" [height]="40" width="40" [address]="user.identity.address">
                </eth-blockie>
                <h4>{{user.identity.domain}}</h4>
                <a [href]="explorerUrl + user.identity.address" target="_blank" rel="noopener">
                  {{user.identity.address}}
                </a>
              </div>
              <div class="wallet-balance">
                <!-- Balance -->
                <ng-container *ngIf="!(isBalanceLoading$ | async); else isLoading">
                  <button class="balance" mat-button matTooltip="Click to refresh" (click)="refreshBalance()">
                    {{user.balance || '0.0'}} ETH
                  </button>
                </ng-container>
                <ng-template #isLoading>
                  <button mat-button [disabled]="true">
                    <mat-spinner [diameter]="24" [strokeWidth]="2"></mat-spinner>
                  </button>
                </ng-template>
                <div>
                  <mat-form-field appearance="outline" floatLabel="always">
                    <mat-label>Buy Tokens</mat-label>
                    <input matInput type="number" min="0.01" max="0.1" step="0.01" placeholder="token amount" [(ngModel)]="amount">
                    <span matSuffix>
                      ETH
                      <!-- <button mat-raised-button color="primary" (click)="requestTokens()">Buy</button> -->
                    </span>
                  </mat-form-field>
                  <button mat-raised-button color="primary" (click)="requestTokens()">Buy</button>
                </div>
              </div>
            </header>

            <ng-container *ngIf="hasKeystore$ | async; else recoverWallet">
              <!-- Private Key -->
              <article fxLayout="row" fxLayoutAlign="start center" class="private-key">
                <ng-container *ngIf="!(loadingPrivateKey$ | async); else loadPrivateKey">
                  <button mat-button (click)="getPrivateKey()">
                    <mat-icon>vpn_key</mat-icon>
                    <span>Show Private Key</span>
                  </button>
                </ng-container>
                <ng-template #loadPrivateKey>
                  <mat-icon class="loading">autorenew</mat-icon>
                </ng-template>
                <span *ngIf="privateKey$ | async as privKey">{{ privKey }}</span>
              </article>
            </ng-container>

            <!-- Recover -->
            <ng-template #recoverWallet class="recover">
              <button mat-button (click)="recover()">
                <mat-icon>cloud_upload</mat-icon>
                <span>Recover your wallet</span>
              </button>
            </ng-template>
          </ng-container>
          <ng-template #walletLoading>
            <div class="wallet-loading">
              <p>Your Wallet is loading...</p>
              <mat-progress-bar mode="indeterminate"></mat-progress-bar>
            </div>
          </ng-template>
          <!-- /WALLET -->
        </section>
      </mat-expansion-panel>
    </mat-accordion>
  </mat-card>
</main>
