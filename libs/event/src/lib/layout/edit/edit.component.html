<ng-template pageBar>
  <header fxLayout fxLayoutAlign="space-between center">
    <a mat-icon-button routerLink="../..">
      <mat-icon svgIcon="arrow_back"></mat-icon>
    </a>
    <div fxLayout fxLayoutAlign="end center">
      <ng-container *ngIf="form.dirty">
        <button @scaleIn type="submit" mat-stroked-button color="primary" (click)="save()" test-id="event-save">Save</button>
      </ng-container>
      <button type="button" mat-button color="warn" (click)="remove()">Delete</button>
    </div>
  </header>
</ng-template>

<form [formGroup]="form">
  <section fxLayout="column" fxLayoutGap="24px">
    <h2>Details</h2>
    <mat-card class="details" fxLayout="column" fxFlex="65">
      <mat-form-field appearance="outline">
        <mat-label>Event Title</mat-label>
        <input matInput formControlName="title" test-id="event-title" />
      </mat-form-field>

      <div fxLayout fxLayoutAlign="space-between center" fxLayoutGap="24px">
        <mat-form-field fxFlex appearance="outline" test-id="event-start">
          <mat-label>Start</mat-label>
          <time-picker formControlName="start"></time-picker>
        </mat-form-field>
        <span>to</span>
        <mat-form-field fxFlex  appearance="outline" test-id="event-end">
          <mat-label>End</mat-label>
          <time-picker formControlName="end"></time-picker>
        </mat-form-field>
      </div>
      
      <mat-checkbox formControlName="isPrivate" test-id="event-private">Private</mat-checkbox>
      <mat-checkbox formControlName="allDay">All day</mat-checkbox>

    </mat-card>

    <!-- Meta content -->
    <ng-content></ng-content>


    <h2>Invitations</h2>
    <mat-card class="invitations" fxLayout="column"  fxFlex="35">
      <div fxLayout fxLayout="space-between center" fxLayoutGap="16px">
        <algolia-chips-autocomplete fxFlex
          index="user"
          displayWithPath="email"
          [form]="invitationForm"
          label="Search for a guest"
          placeholder="Enter guest email"
        >
          <ng-template let-user>
            <div class="profile-item" fxLayout fxLayoutAlign="strt center" fxLayoutGap="8px">
              <img [imgRef]="user.avatar.media" placeholderAsset="profil_user.webp" alt="Profile" />
              <span *ngIf="user.firstName">{{ user | displayName }}</span>
              <span *ngIf="!user.firstName">{{ user.email }}</span>
            </div>
          </ng-template>
        </algolia-chips-autocomplete>
        <button mat-icon-button (click)="invite()" test-id="event-invite">
          <mat-icon svgIcon="send"></mat-icon>
        </button>
      </div>

      <ng-container *ngIf="sending | async">
        <div @scaleIn fxLayout="column" fxLayoutAlign="center center">
          <p class="mat-caption">
            We're sending invitations, this process can take few minutes.
            <br/>
            You can leave the page without canceling the process, we'll update this page when it's done.
          </p>
          <mat-progress-bar color="accent" mode="buffer"></mat-progress-bar>
        </div>
      </ng-container>
      <!-- @todo(#2763) Add loading indication here -->
      <invitation-guest-list [invitations]="invitations"></invitation-guest-list>
    </mat-card>
  </section>
</form>


